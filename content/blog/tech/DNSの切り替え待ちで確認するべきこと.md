---
title: "DNSの切り替え待ちで確認すること"
date: 2020-11-15T08:23:22+09:00
draft: false
slug: "check-switch-dns"
---

切り替えにかかる時間がちょっと長いな、とおもったときに、確認しておいても良いな、と思ったのでメモ。

<!-- more -->

はじめに
----

昔はサーバーの切り替えをすると、DNSが浸透するまでに最大72時間くらいかかるから気長に待ちましょう、といわれていた。

ドメインを新しくつくったり、ドメインを別のサーバーに移し替える作業を行うと、ドメインをIPアドレスに変換してくれるDNSサーバーの情報が更新されるのを待たなければならない。

最近はその時間がとても短くて10分、15分で新しいサーバーに紐づけされる。

前回、[VercelからGitHub Pagesにホスト先を移転]({{< ref "VercelからGitHubPageへの引っ越し.md" >}})したが、12時間が経っても切り替えられていないので、さすがにちょっと長いかな、と思った。

紐づけされているIPアドレスの確認{#check-ip}
----

[ドメイン/IPアドレス サーチ 【whois情報検索】](http://www.cman.jp/network/support/ip.html)にアクセスすると、指定したドメインがどこのIPアドレスに紐づけられているのか確認することができる。

もし、古いサーバーのままであるなら、ただ単にIPアドレスの移行が遅れているだけ、ということになるが、もし、新しいサーバーに切り替わっているなら別の問題が起こっている。

当方のケースでは、VercelのIPアドレスのままだったので、DNSの切り替え中なのか、それとも何かの要因で切り替えられないのか、ということが考えられた。

ネームサーバーの確認{#check-nameserver}
----

Aコードだけ変えて、ネームサーバーがどこになっているか、確認していない、なんてことありませんか？(うちの場合)

CDNを効かせようと思ったとき、ドメインをとったレジストラーからほかに移している、ということがある。

当方のケースで言うと、過去に[Cloudflare](https://www.cloudflare.com/ja-jp/)に登録して、そちらにネームサーバーを移行していたのをすっかり忘れていた。

Cloudflareの設定を変えても良かったが、CDNをつかわなくても良いかと思ったので、Cloudflareのネームサーバーからレジストラーの提供しているネームサーバーに変更したところ、30分ほどで切り替えが終了した。

教訓
----

今の御時世、DNSの浸透に最大72時間かかる、というのはもはや都市伝説になっている。

若干、待つ時間と気長さは必要とはいえ、24時間待つのはやりすぎた。

1時間経っても切り替えられていないのなら、何かほかに原因があるのかと疑るべき。

ネームサーバーの変更のし忘れは今後、疑るべきことと学んだ。
